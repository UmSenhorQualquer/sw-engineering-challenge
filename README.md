# Lauch the services

To launch the services, run the following commands:

```bash
docker-compose up --build -d bloqit_db
docker-compose up --build -d bloqit_api
```

# API Documentation

The API documentation is available at http://localhost:8000/docs.

# Tests

Set the environment with Anaconda and install the dependencies:

```bash
conda install -n bloq python==3.10
pip install -r requirements.txt
pip install -r tests/requirements.txt
pip install -e .
```

Run the API tests:

```bash
pytest tests/api_tests/ -v --cov=bloqit -s
```

Run the performance tests:

```bash
python tests/performance_tests/test_performance.py
```

# Test results

## API Tests

```bash

pytest tests/api_tests/ -v --cov=bloqit -s
=================================== test session starts ===========================================
platform linux -- Python 3.10.0, pytest-7.4.3, pluggy-1.5.0 -- /home/manager/miniconda3/envs/bloq/bin/python
cachedir: .pytest_cache
rootdir: /home/manager/repos/sw-engineering-challenge
plugins: cov-4.1.0, anyio-4.7.0, asyncio-0.21.1
asyncio: mode=strict
collected 12 items

tests/api_tests/test_bloqs.py::test_get_bloqs PASSED
tests/api_tests/test_bloqs.py::test_get_bloq PASSED
tests/api_tests/test_bloqs.py::test_create_bloq PASSED
tests/api_tests/test_lockers.py::test_get_lockers PASSED
tests/api_tests/test_lockers.py::test_get_locker PASSED
tests/api_tests/test_lockers.py::test_create_locker PASSED
tests/api_tests/test_lockers.py::test_update_locker_status PASSED
tests/api_tests/test_rents.py::test_get_rents PASSED
tests/api_tests/test_rents.py::test_get_rent PASSED
tests/api_tests/test_rents.py::test_create_rent PASSED
tests/api_tests/test_rents.py::test_update_rent_status PASSED
tests/api_tests/test_rents.py::test_rent_lifecycle PASSED

---------- coverage: platform linux, python 3.10.0-final-0 -----------
Name                         Stmts   Miss  Cover
------------------------------------------------
bloqit/data.py                  39     28    28%
bloqit/database.py              13      2    85%
bloqit/main.py                  22      2    91%
bloqit/models/__init__.py        3      0   100%
bloqit/models/bloq.py            7      0   100%
bloqit/models/locker.py         14      0   100%
bloqit/models/rent.py           21      0   100%
bloqit/routers/__init__.py       1      0   100%
bloqit/routers/bloqs.py         22      0   100%
bloqit/routers/lockers.py       31      0   100%
bloqit/routers/rents.py         31      0   100%
------------------------------------------------
TOTAL                          204     32    84%


=========================== 12 passed in 0.50s ==========================

```


## Performance tests

Tested on **Ubuntu 22.04.5 LTS** with an **Intel(R) Core(TM) i5-9600K CPU @ 3.70GHz** processor.

```bash
python tests/performance_tests/test_performance.py

API Performance Test Results:
================================================================================

Testing endpoint: /bloqs/
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |     113.69 |    0.0031 |    0.0159 |     0.0085 |       0.008  |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     940.64 |    0.0032 |    0.0222 |     0.0051 |       0.0048 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |    1003.29 |    0.0037 |    0.0244 |     0.0096 |       0.009  |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |     866.71 |    0.0043 |    0.0868 |     0.0218 |       0.0208 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |    1028.21 |    0.0039 |    0.1445 |     0.0407 |       0.0372 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     765.42 |    0.0041 |    0.3003 |     0.0943 |       0.0971 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+



Testing endpoint: /bloqs/22ffa3c5-3a3d-4f71-81f1-cac18ffbc510
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |      78.74 |    0.0055 |    0.0233 |     0.0123 |       0.0111 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     891.55 |    0.0034 |    0.0234 |     0.0053 |       0.0051 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |    1038.53 |    0.0041 |    0.0201 |     0.0091 |       0.0087 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |    1078.94 |    0.0053 |    0.0474 |     0.0172 |       0.0166 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |    1020.16 |    0.0073 |    0.1155 |     0.0409 |       0.0389 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     849.61 |    0.0049 |    0.2412 |     0.0893 |       0.0903 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+



Testing endpoint: /lockers/
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |     103.81 |    0.0031 |    0.0158 |     0.0093 |       0.0093 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     921.73 |    0.0034 |    0.0109 |     0.005  |       0.0049 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |    1070.24 |    0.0038 |    0.0188 |     0.0088 |       0.0086 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |     870.36 |    0.0044 |    0.0539 |     0.0218 |       0.0213 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |     745.51 |    0.0091 |    0.1688 |     0.0594 |       0.0569 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     679    |    0.0105 |    0.3446 |     0.1142 |       0.1063 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+



Testing endpoint: /lockers/2191e1b5-99c7-45df-8302-998be394be48
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |      53.7  |    0.0061 |    0.0253 |     0.0181 |       0.019  |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     675.02 |    0.0037 |    0.0225 |     0.0071 |       0.0071 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |     770.78 |    0.0044 |    0.0265 |     0.0126 |       0.0124 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |     776.87 |    0.0043 |    0.0514 |     0.0245 |       0.0244 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |     708.31 |    0.0093 |    0.1384 |     0.0624 |       0.0605 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     685.18 |    0.01   |    0.3778 |     0.1137 |       0.1095 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+



Testing endpoint: /rents/
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |      88.79 |    0.0033 |    0.0155 |     0.0109 |       0.0123 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     943.81 |    0.0033 |    0.0153 |     0.005  |       0.0049 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |    1091.92 |    0.0038 |    0.0197 |     0.0087 |       0.0086 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |    1119.63 |    0.0045 |    0.0566 |     0.0165 |       0.0159 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |     773.72 |    0.004  |    0.148  |     0.0561 |       0.0568 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     797.62 |    0.0118 |    0.4377 |     0.0923 |       0.08   |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+



Testing endpoint: /rents/feb72a9a-258d-49c9-92de-f90b1f11984d
----------------------------------------
Running tests with 1 workers...
Running tests with 5 workers...
Running tests with 10 workers...
Running tests with 20 workers...
Running tests with 50 workers...
Running tests with 100 workers...

+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|   Workers |   Total Reqs |   Successful |   Failed |   Reqs/sec |   Min (s) |   Max (s) |   Mean (s) |   Median (s) |
+===========+==============+==============+==========+============+===========+===========+============+==============+
|         1 |         1000 |         1000 |        0 |      96.3  |    0.0034 |    0.0161 |     0.01   |       0.0097 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|         5 |         1000 |         1000 |        0 |     883.77 |    0.0034 |    0.0134 |     0.0053 |       0.0051 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        10 |         1000 |         1000 |        0 |    1031.17 |    0.0041 |    0.0195 |     0.0092 |       0.0089 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        20 |         1000 |         1000 |        0 |    1068.32 |    0.0046 |    0.0792 |     0.0174 |       0.0169 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|        50 |         1000 |         1000 |        0 |    1001.44 |    0.0044 |    0.1172 |     0.0436 |       0.0419 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
|       100 |         1000 |         1000 |        0 |     741.1  |    0.0044 |    0.4245 |     0.0974 |       0.0963 |
+-----------+--------------+--------------+----------+------------+-----------+-----------+------------+--------------+
```
